<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Tab</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bad+Script&family=Cagliostro&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/styles.css" />
  </head>
  <body>
    <button class="settings-button" onclick="navigateToSettings()"></button>
    <div id="container" class="container" />

    <script>
      function navigateToSettings() {
        window.location.href = "settings.html";
      }

      function loadSettings() {
        const defaultSettings = { type: "Home", style: "Modern" };
        const savedSettings =
          JSON.parse(localStorage.getItem("userSettings")) || defaultSettings;

        const { type, style } = savedSettings;

        // Dynamically load the CSS file based on the style
        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = `/styles/${style.toLowerCase().replace("-", "_")}.css`;
        document.head.appendChild(link);
      }

      loadSettings();

      async function loadData() {
        try {
          // Load JSON data
          const [categories, urls] = await Promise.all([
            fetch("data/categories.json").then((res) => res.json()),
            fetch("data/urls.json").then((res) => res.json()),
          ]);

          // Create a lookup for category names by ID
          const categoryMap = {};
          categories.forEach((cat) => (categoryMap[cat.id] = cat.name));

          // Group URLs by category
          const categorizedLinks = {};
          urls.forEach((url) => {
            url.categories.forEach((catId) => {
              if (!categorizedLinks[catId]) {
                categorizedLinks[catId] = [];
              }
              categorizedLinks[catId].push(url);
            });
          });

          // Build the DOM
          const container = document.getElementById("container");

          Object.entries(categorizedLinks).forEach(([catId, links]) => {
            const categoryDiv = document.createElement("div");
            categoryDiv.classList.add("category");

            const heading = document.createElement("h2");
            heading.textContent = categoryMap[catId] || catId;
            categoryDiv.appendChild(heading);

            const ul = document.createElement("ul");
            ul.classList.add("links");

            links.forEach(({ url, name, shortName, faviconExtension }) => {
              const li = document.createElement("li");
              const a = document.createElement("a");
              a.href = url;
              a.textContent = ` ${name}`;

              const img = document.createElement("img");
              img.src = `images/${shortName}.${faviconExtension}`;
              img.alt = name;

              a.prepend(img);
              li.appendChild(a);
              ul.appendChild(li);
            });

            categoryDiv.appendChild(ul);
            container.appendChild(categoryDiv);
          });
        } catch (error) {
          console.error("Error loading data:", error);
        }
      }

      loadData();
    </script>
  </body>
</html>
